# WebSocket Integration - Система активности пользователей

## Что было добавлено

### Backend (Flask + Flask-SocketIO)
1. **Новые зависимости** в `requirements.txt`:
   - `Flask-SocketIO==5.3.6`
   - `python-socketio==5.9.0`
   - `eventlet==0.33.3`

2. **WebSocket обработчики** в `app.py`:
   - `connect` - подключение клиента
   - `disconnect` - отключение клиента
   - `user_online` - пользователь зашел в систему
   - `user_activity` - обновление активности
   - `join_room` / `leave_room` - работа с комнатами

3. **Хранилище активных пользователей** - в памяти сервера

### Frontend (React + Socket.IO)
1. **Новая зависимость** в `package.json`:
   - `socket.io-client==4.7.2`

2. **WebSocket сервис** (`services/websocket.js`):
   - Подключение/отключение
   - Отправка активности
   - Подписка на события

3. **Компонент OnlineUsers** (`components/OnlineUsers.js`):
   - Показ аватаров онлайн пользователей
   - Индикатор подключения
   - Детальная информация о пользователях

4. **Трекер активности** (`hooks/useActivityTracker.js`):
   - Отслеживание действий пользователя
   - Периодическая отправка активности

5. **Интеграция в AuthContext**:
   - Автоматическое подключение при логине
   - Отключение при логауте

## Как запустить

### 1. Установка зависимостей

**Backend:**
```bash
cd backend
pip install -r requirements.txt
```

**Frontend:**
```bash
cd frontend
npm install
```

### 2. Запуск через Docker Compose
```bash
docker-compose up --build
```

### 3. Или запуск вручную

**Backend:**
```bash
cd backend
python app.py
```

**Frontend:**
```bash
cd frontend
npm start
```

## Функциональность

### Что вы увидите:
1. **В Navbar** - кнопка с количеством онлайн пользователей
2. **При клике** - выпадающий список с аватарами и информацией
3. **Real-time обновления** - пользователи появляются/исчезают мгновенно
4. **Индикаторы**:
   - Зеленый кружок = онлайн
   - Wi-Fi иконка = подключение к WebSocket
   - Цветные бейджи = роли пользователей

### События WebSocket:
- `user_online` - пользователь зашел
- `user_offline` - пользователь вышел
- `active_users` - список всех онлайн
- `user_activity` - обновление активности

## Тестирование

1. **Откройте несколько вкладок/браузеров**
2. **Войдите под разными пользователями**
3. **Наблюдайте** как аватары появляются в реальном времени
4. **Закройте вкладку** - пользователь исчезнет из списка
5. **Активность** отслеживается автоматически

## Особенности реализации

### Безопасность:
- WebSocket подключение только для аутентифицированных пользователей
- CORS настроен для localhost:3000
- Cookies для аутентификации

### Производительность:
- Активность отправляется максимум раз в 30 секунд
- События активности фильтруются
- Автоматическая очистка при отключении

### UI/UX:
- Анимации и индикаторы
- Responsive дизайн
- Интуитивный интерфейс как в Google Docs

## Возможные улучшения

1. **Персистентное хранение** активных пользователей (Redis)
2. **Уведомления** о входе/выходе пользователей
3. **Комнаты** для проектов (кто смотрит какой проект)
4. **Статусы** (онлайн, отошел, занят)
5. **История активности** пользователей

